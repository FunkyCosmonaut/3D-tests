#include "window.h"
#include <math.h>
#include <cglm/cglm.h>
mat4 m;

unsigned int shaderProgram;
unsigned int VBO, VAO, EBO;
char *load_file(char *filename){

	char *buffer = 0;
	long length;
	FILE *f = fopen(filename, "r");
	if(f){
		fseek(f, 0, SEEK_END);
		length = ftell(f);
		fseek(f, 0, SEEK_SET);
		buffer = malloc(length);
		if(buffer)
		{
			fread(buffer, 1, length, f);
		}
		fclose(f);
	}
	return buffer;
}

void init(){
float vertices[] = {
     1.25000000,0.0000000e+0,0.0000000e+0
,1.17677670,-0.17677670,0.0000000e+0
,1.00000000,-0.25000000,0.0000000e+0
,0.82322330,-0.17677670,0.0000000e+0
,0.75000000,-3.0616170e-17,0.0000000e+0
,0.82322330,0.17677670,0.0000000e+0
,1.00000000,0.25000000,0.0000000e+0
,1.17677670,0.17677670,0.0000000e+0
,1.15484942,0.0000000e+0,0.47835429
,1.08719990,-0.17677670,0.45033294
,0.92387953,-0.25000000,0.38268343
,0.76055916,-0.17677670,0.31503392
,0.69290965,-3.0616170e-17,0.28701257
,0.76055916,0.17677670,0.31503392
,0.92387953,0.25000000,0.38268343
,1.08719990,0.17677670,0.45033294
,0.88388348,0.0000000e+0,0.88388348
,0.83210678,-0.17677670,0.83210678
,0.70710678,-0.25000000,0.70710678
,0.58210678,-0.17677670,0.58210678
,0.53033009,-3.0616170e-17,0.53033009
,0.58210678,0.17677670,0.58210678
,0.70710678,0.25000000,0.70710678
,0.83210678,0.17677670,0.83210678
,0.47835429,0.0000000e+0,1.15484942
,0.45033294,-0.17677670,1.08719990
,0.38268343,-0.25000000,0.92387953
,0.31503392,-0.17677670,0.76055916
,0.28701257,-3.0616170e-17,0.69290965
,0.31503392,0.17677670,0.76055916
,0.38268343,0.25000000,0.92387953
,0.45033294,0.17677670,1.08719990
,7.6540425e-17,0.0000000e+0,1.25000000
,7.2056791e-17,-0.17677670,1.17677670
,6.1232340e-17,-0.25000000,1.00000000
,5.0407889e-17,-0.17677670,0.82322330
,4.5924255e-17,-3.0616170e-17,0.75000000
,5.0407889e-17,0.17677670,0.82322330
,6.1232340e-17,0.25000000,1.00000000
,7.2056791e-17,0.17677670,1.17677670
,-0.47835429,0.0000000e+0,1.15484942
,-0.45033294,-0.17677670,1.08719990
,-0.38268343,-0.25000000,0.92387953
,-0.31503392,-0.17677670,0.76055916
,-0.28701257,-3.0616170e-17,0.69290965
,-0.31503392,0.17677670,0.76055916
,-0.38268343,0.25000000,0.92387953
,-0.45033294,0.17677670,1.08719990
,-0.88388348,0.0000000e+0,0.88388348
,-0.83210678,-0.17677670,0.83210678
,-0.70710678,-0.25000000,0.70710678
,-0.58210678,-0.17677670,0.58210678
,-0.53033009,-3.0616170e-17,0.53033009
,-0.58210678,0.17677670,0.58210678
,-0.70710678,0.25000000,0.70710678
,-0.83210678,0.17677670,0.83210678
,-1.15484942,0.0000000e+0,0.47835429
,-1.08719990,-0.17677670,0.45033294
,-0.92387953,-0.25000000,0.38268343
,-0.76055916,-0.17677670,0.31503392
,-0.69290965,-3.0616170e-17,0.28701257
,-0.76055916,0.17677670,0.31503392
,-0.92387953,0.25000000,0.38268343
,-1.08719990,0.17677670,0.45033294
,-1.25000000,0.0000000e+0,1.5308085e-16
,-1.17677670,-0.17677670,1.4411358e-16
,-1.00000000,-0.25000000,1.2246468e-16
,-0.82322330,-0.17677670,1.0081578e-16
,-0.75000000,-3.0616170e-17,9.1848510e-17
,-0.82322330,0.17677670,1.0081578e-16
,-1.00000000,0.25000000,1.2246468e-16
,-1.17677670,0.17677670,1.4411358e-16
,-1.15484942,0.0000000e+0,-0.47835429
,-1.08719990,-0.17677670,-0.45033294
,-0.92387953,-0.25000000,-0.38268343
,-0.76055916,-0.17677670,-0.31503392
,-0.69290965,-3.0616170e-17,-0.28701257
,-0.76055916,0.17677670,-0.31503392
,-0.92387953,0.25000000,-0.38268343
,-1.08719990,0.17677670,-0.45033294
,-0.88388348,0.0000000e+0,-0.88388348
,-0.83210678,-0.17677670,-0.83210678
,-0.70710678,-0.25000000,-0.70710678
,-0.58210678,-0.17677670,-0.58210678
,-0.53033009,-3.0616170e-17,-0.53033009
,-0.58210678,0.17677670,-0.58210678
,-0.70710678,0.25000000,-0.70710678
,-0.83210678,0.17677670,-0.83210678
,-0.47835429,0.0000000e+0,-1.15484942
,-0.45033294,-0.17677670,-1.08719990
,-0.38268343,-0.25000000,-0.92387953
,-0.31503392,-0.17677670,-0.76055916
,-0.28701257,-3.0616170e-17,-0.69290965
,-0.31503392,0.17677670,-0.76055916
,-0.38268343,0.25000000,-0.92387953
,-0.45033294,0.17677670,-1.08719990
,-2.2962127e-16,0.0000000e+0,-1.25000000
,-2.1617037e-16,-0.17677670,-1.17677670
,-1.8369702e-16,-0.25000000,-1.00000000
,-1.5122367e-16,-0.17677670,-0.82322330
,-1.3777276e-16,-3.0616170e-17,-0.75000000
,-1.5122367e-16,0.17677670,-0.82322330
,-1.8369702e-16,0.25000000,-1.00000000
,-2.1617037e-16,0.17677670,-1.17677670
,0.47835429,0.0000000e+0,-1.15484942
,0.45033294,-0.17677670,-1.08719990
,0.38268343,-0.25000000,-0.92387953
,0.31503392,-0.17677670,-0.76055916
,0.28701257,-3.0616170e-17,-0.69290965
,0.31503392,0.17677670,-0.76055916
,0.38268343,0.25000000,-0.92387953
,0.45033294,0.17677670,-1.08719990
,0.88388348,0.0000000e+0,-0.88388348
,0.83210678,-0.17677670,-0.83210678
,0.70710678,-0.25000000,-0.70710678
,0.58210678,-0.17677670,-0.58210678
,0.53033009,-3.0616170e-17,-0.53033009
,0.58210678,0.17677670,-0.58210678
,0.70710678,0.25000000,-0.70710678
,0.83210678,0.17677670,-0.83210678
,1.15484942,0.0000000e+0,-0.47835429
,1.08719990,-0.17677670,-0.45033294
,0.92387953,-0.25000000,-0.38268343
,0.76055916,-0.17677670,-0.31503392
,0.69290965,-3.0616170e-17,-0.28701257
,0.76055916,0.17677670,-0.31503392
,0.92387953,0.25000000,-0.38268343
,1.08719990,0.17677670,-0.45033294   // top left
};
unsigned int indices[] = {  // note that we start from 0!
	 1, 9, 10, 2,
 1, 121, 128, 8,
 2, 10, 11, 3,
 2, 122, 121, 1,
 3, 11, 12, 4,
 3, 123, 122, 2,
 4, 12, 13, 5,
 4, 124, 123, 3,
 5, 13, 14, 6,
 5, 125, 124, 4,
 6, 14, 15, 7,
 6, 126, 125, 5,
 7, 15, 16, 8,
 7, 127, 126, 6,
 8, 16, 9, 1,
 8, 128, 127, 7,
 9, 17, 18, 10,
 10, 18, 19, 11,
 11, 19, 20, 12,
 12, 20, 21, 13,
 13, 21, 22, 14,
 14, 22, 23, 15,
 15, 23, 24, 16,
 16, 24, 17, 9,
 17, 25, 26, 18,
 18, 26, 27, 19,
 19, 27, 28, 20,
 20, 28, 29, 21,
 21, 29, 30, 22,
 22, 30, 31, 23,
 23, 31, 32, 24,
 24, 32, 25, 17,
 25, 33, 34, 26,
 26, 34, 35, 27,
 27, 35, 36, 28,
 28, 36, 37, 29,
 29, 37, 38, 30,
 30, 38, 39, 31,
 31, 39, 40, 32,
 32, 40, 33, 25,
 33, 41, 42, 34,
 34, 42, 43, 35,
 35, 43, 44, 36,
 36, 44, 45, 37,
 37, 45, 46, 38,
 38, 46, 47, 39,
 39, 47, 48, 40,
 40, 48, 41, 33,
 41, 49, 50, 42,
 42, 50, 51, 43,
 43, 51, 52, 44,
 44, 52, 53, 45,
 45, 53, 54, 46,
 46, 54, 55, 47,
 47, 55, 56, 48,
 48, 56, 49, 41,
 49, 57, 58, 50,
 50, 58, 59, 51,
 51, 59, 60, 52,
 52, 60, 61, 53,
 53, 61, 62, 54,
 54, 62, 63, 55,
 55, 63, 64, 56,
 56, 64, 57, 49,
 57, 65, 66, 58,
 58, 66, 67, 59,
 59, 67, 68, 60,
 60, 68, 69, 61,
 61, 69, 70, 62,
 62, 70, 71, 63,
 63, 71, 72, 64,
 64, 72, 65, 57,
 65, 73, 74, 66,
 66, 74, 75, 67,
 67, 75, 76, 68,
 68, 76, 77, 69,
 69, 77, 78, 70,
 70, 78, 79, 71,
 71, 79, 80, 72,
 72, 80, 73, 65,
 73, 81, 82, 74,
 74, 82, 83, 75,
 75, 83, 84, 76,
 76, 84, 85, 77,
 77, 85, 86, 78,
 78, 86, 87, 79,
 79, 87, 88, 80,
 80, 88, 81, 73,
 81, 89, 90, 82,
 82, 90, 91, 83,
 83, 91, 92, 84,
 84, 92, 93, 85,
 85, 93, 94, 86,
 86, 94, 95, 87,
 87, 95, 96, 88,
 88, 96, 89, 81,
 89, 97, 98, 90,
 90, 98, 99, 91,
 91, 99, 100, 92,
 92, 100, 101, 93,
 93, 101, 102, 94,
 94, 102, 103, 95,
 95, 103, 104, 96,
 96, 104, 97, 89,
 97, 105, 106, 98,
 98, 106, 107, 99,
 99, 107, 108, 100,
 100, 108, 109, 101,
 101, 109, 110, 102,
 102, 110, 111, 103,
 103, 111, 112, 104,
 104, 112, 105, 97,
 105, 113, 114, 106,
 106, 114, 115, 107,
 107, 115, 116, 108,
 108, 116, 117, 109,
 109, 117, 118, 110,
 110, 118, 119, 111,
 111, 119, 120, 112,
 112, 120, 113, 105,
 113, 121, 122, 114,
 114, 122, 123, 115,
 115, 123, 124, 116,
 116, 124, 125, 117,
 117, 125, 126, 118,
 118, 126, 127, 119,
 119, 127, 128, 120,
 120, 128, 121, 113,
};
	//initialize vertex Buffer Object
//	unsigned int VBO, VAO;
//	moved these decs to top

	glGenVertexArrays(1, &VAO);
	
	glGenBuffers(1, &VBO);
	glGenBuffers(1, &EBO);
	glBindVertexArray(VAO);
//VBO stuff	
	glBindBuffer(GL_ARRAY_BUFFER, VBO);
	glBufferData(GL_ARRAY_BUFFER, sizeof(vertices), vertices, GL_STATIC_DRAW);

//EBO stuff
	glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, EBO);
	glBufferData(GL_ELEMENT_ARRAY_BUFFER, sizeof(indices), indices, GL_STATIC_DRAW);
	glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 3 * sizeof(float), (void*)0);
	glEnableVertexAttribArray(0);

	//For every object
	glBindVertexArray(0);


	}

void loadShaders(){
	
	const char *fragmentShaderSource = load_file("src/shader.frag");
	const char *vertexShaderSource = load_file("src/shader.vert"); 

	unsigned int vertexShader;
	vertexShader = glCreateShader(GL_VERTEX_SHADER);
	printf("%s\n", fragmentShaderSource);

	glShaderSource(vertexShader, 1 , &vertexShaderSource, NULL);
	glCompileShader(vertexShader);

	int success;
	char infoLog[512];
	glGetShaderiv(vertexShader, GL_COMPILE_STATUS, &success);
		if(!success)
	{
		glGetShaderInfoLog(vertexShader, 512, NULL, infoLog);
		printf("ERROR COMPILIN VERTEX SHADER DUMMY\n%s\n", infoLog);
	}

	unsigned int fragmentShader;
	fragmentShader = glCreateShader(GL_FRAGMENT_SHADER);
	glShaderSource(fragmentShader, 1, &fragmentShaderSource, NULL);
	glCompileShader(fragmentShader);

	glGetShaderiv(fragmentShader, GL_COMPILE_STATUS, &success);
	if(!success)
	{
		glGetShaderInfoLog(fragmentShader, 512, NULL, infoLog);
		printf("ERROR COMPILING FRAGMENT SHADER\n%s\n",infoLog);
	}
	
//	unsigned int shaderProgram;
//	moved this dec to the top for global
	shaderProgram = glCreateProgram();

	glAttachShader(shaderProgram, vertexShader);
	glAttachShader(shaderProgram, fragmentShader);
	glLinkProgram(shaderProgram);

	glGetProgramiv(shaderProgram, GL_LINK_STATUS, &success);
	if(!success){
		glGetProgramInfoLog(shaderProgram, 512, NULL, infoLog);
		printf("ERROR LINKING\n%s\n", infoLog);
	}
	glUseProgram(shaderProgram);
	glDeleteShader(vertexShader);
	glDeleteShader(fragmentShader);

}

void render(){


	glClearColor(0.2f, 0.5f, 0.3, 1.0f);
	glClear(GL_COLOR_BUFFER_BIT);
	glUseProgram(shaderProgram);
	glBindVertexArray(VAO);
//	glDrawArrays(GL_TRIANGLES, 0, 6);


	glDrawElements(GL_LINE_LOOP, 600, GL_UNSIGNED_INT, 0);
	//Moved everything to its own function init.
	//I had the shader here before too,
	////moved it because didn't need to be in the loop
}
